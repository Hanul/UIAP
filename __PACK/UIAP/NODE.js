UIAP.APP_STORE_PURCHASE_VALIDATE=METHOD({run:(e,o)=>{let t,n,r=e.productId,i=e.receipt;void 0!==o&&(CHECK_IS_DATA(o)!==!0?n=o:(t=o.error,n=o.success));let a=0,s=()=>{a+=1;let e="buy.itunes.apple.com";RUN(o=>{let c;POST(c={isSecure:!0,host:e,uri:"verifyReceipt",paramStr:JSON.stringify({"receipt-data":i})},{error:e=>{a<2?s():void 0!==t?t(e):UIAP.SHOW_ERROR("APP_STORE_PURCHASE_VALIDATE",e,c)},success:i=>{let c=PARSE_STR(i),p=!1;void 0===c?a<2?s():void 0!==t?t("Error! Data: "+i):UIAP.SHOW_ERROR("APP_STORE_PURCHASE_VALIDATE","Error! Data: "+i):(0===c.status&&void 0!==c.receipt&&(c.receipt.product_id===r?p=!0:void 0!==c.receipt.in_app&&EACH(c.receipt.in_app,e=>{if(e.product_id===r)return p=!0,!1})),p!==!0&&"sandbox.itunes.apple.com"!==e?(e="sandbox.itunes.apple.com",o()):void 0!==n&&n(p))}})})};s()}}),UIAP.GOOGLE_PLAY_PURCHASE_VALIDATE=METHOD(e=>{let o,t,n="https://www.googleapis.com/oauth2/v4/token",r=require("url"),i=require("crypto"),a=r.parse(n);return{run:(e,r)=>{let s,c,p=e.productId,u=e.purchaseToken;void 0!==r&&(CHECK_IS_DATA(r)!==!0?c=r:(s=r.error,c=r.success));let E=0,d=()=>{E+=1,NEXT([e=>{if(void 0===o||Date.now()-t.getTime()>18e5){let r=INTEGER(Date.now()/1e3),c=r+INTEGER(3600),p={iss:NODE_CONFIG.UIAP.GooglePlay.clientEmail,scope:"https://www.googleapis.com/auth/androidpublisher",aud:n,exp:c,iat:r},u=new Buffer(STRINGIFY({alg:"RS256",typ:"JWT"})).toString("base64")+"."+new Buffer(STRINGIFY(p)).toString("base64");u+="."+i.createSign("RSA-SHA256").update(u).sign(NODE_CONFIG.UIAP.GooglePlay.privateKey,"base64"),POST({isSecure:"https:"===a.protocol,host:a.hostname===TO_DELETE?void 0:a.hostname,port:a.port===TO_DELETE?void 0:INTEGER(a.port),uri:a.pathname===TO_DELETE?void 0:a.pathname.substring(1),paramStr:"grant_type="+encodeURIComponent("urn:ietf:params:oauth:grant-type:jwt-bearer")+"&assertion="+encodeURIComponent(u),headers:{"Content-Type":"application/x-www-form-urlencoded"}},{error:e=>{E<2?d():void 0!==s?s(e):UIAP.SHOW_ERROR("GOOGLE_PLAY_PURCHASE_VALIDATE",e)},success:n=>{let r=PARSE_STR(n);void 0===r?E<2?d():void 0!==s?s("result is undefined."):UIAP.SHOW_ERROR("GOOGLE_PLAY_PURCHASE_VALIDATE","result is undefined."):(o=r.access_token,t=new Date,e())}})}else e()},()=>{return()=>{GET({isSecure:!0,host:"www.googleapis.com",uri:"androidpublisher/v2/applications/"+encodeURIComponent(NODE_CONFIG.UIAP.GooglePlay.appPackageName)+"/purchases/products/"+encodeURIComponent(p)+"/tokens/"+encodeURIComponent(u)+"?access_token="+encodeURIComponent(o)},e=>{let o=PARSE_STR(e);void 0===o?E<2?d():void 0!==s?s("Error! Data: "+e):UIAP.SHOW_ERROR("GOOGLE_PLAY_PURCHASE_VALIDATE","Error! Data: "+e):void 0!==c&&c(void 0!==o.error?!1:void 0!==o.purchaseTimeMillis?!0:!1)})}}])};d()}}});