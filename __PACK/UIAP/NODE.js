UIAP.APP_STORE_PURCHASE_VALIDATE=METHOD({run:(e,o)=>{let t,n,r=e.productId,i=e.receipt;void 0!==o&&(CHECK_IS_DATA(o)!==!0?n=o:(t=o.error,n=o.success));let a=RAR(()=>{let e="buy.itunes.apple.com";RUN(o=>{let t;POST(t={isSecure:!0,host:e,uri:"verifyReceipt",paramStr:JSON.stringify({"receipt-data":i})},{error:()=>{a()},success:t=>{let i=PARSE_STR(t),s=!1;void 0===i?a():(0===i.status&&void 0!==i.receipt&&(i.receipt.product_id===r?s=!0:void 0!==i.receipt.in_app&&EACH(i.receipt.in_app,e=>{if(e.product_id===r)return s=!0,!1})),s!==!0&&"sandbox.itunes.apple.com"!==e?(e="sandbox.itunes.apple.com",o()):void 0!==n&&n(s))}})})})}}),UIAP.GOOGLE_PLAY_GET_VOIDED_PURCHASES=METHOD(e=>{let o="https://www.googleapis.com/oauth2/v4/token",t=require("url"),n=require("crypto"),r=t.parse(o);return{run:e=>{let t,i;void 0!==e&&(CHECK_IS_DATA(e)!==!0?i=e:(t=e.error,i=e.success)),NEXT([e=>{let t=INTEGER(Date.now()/1e3),i=t+INTEGER(3600),a={iss:NODE_CONFIG.UIAP.GooglePlay.clientEmail,scope:"https://www.googleapis.com/auth/androidpublisher",aud:o,exp:i,iat:t},s=Buffer.from(STRINGIFY({alg:"RS256",typ:"JWT"})).toString("base64")+"."+Buffer.from(STRINGIFY(a)).toString("base64");s+="."+n.createSign("RSA-SHA256").update(s).sign(NODE_CONFIG.UIAP.GooglePlay.privateKey,"base64"),POST({isSecure:"https:"===r.protocol,host:r.hostname===TO_DELETE?void 0:r.hostname,port:r.port===TO_DELETE?void 0:INTEGER(r.port),uri:r.pathname===TO_DELETE?void 0:r.pathname.substring(1),paramStr:"grant_type="+encodeURIComponent("urn:ietf:params:oauth:grant-type:jwt-bearer")+"&assertion="+encodeURIComponent(s),headers:{"Content-Type":"application/x-www-form-urlencoded"}},o=>{let t=PARSE_STR(o);void 0!==t&&e(t.access_token)})},()=>{return e=>{GET({isSecure:!0,host:"www.googleapis.com",uri:"androidpublisher/v2/applications/"+encodeURIComponent(NODE_CONFIG.UIAP.GooglePlay.appPackageName)+"/purchases/voidedpurchases?access_token="+encodeURIComponent(e)},e=>{let o=PARSE_STR(e);void 0!==o&&void 0!==o.voidedPurchases&&i(o.voidedPurchases)})}}])}}}),UIAP.GOOGLE_PLAY_PURCHASE_VALIDATE=METHOD(e=>{let o="https://www.googleapis.com/oauth2/v4/token",t=require("url"),n=require("crypto"),r=t.parse(o);return{run:(e,t)=>{let i,a,s=e.productId,p=e.purchaseToken;void 0!==t&&(CHECK_IS_DATA(t)!==!0?a=t:(i=t.error,a=t.success));let c=RAR(()=>{NEXT([e=>{let t=INTEGER(Date.now()/1e3),i=t+INTEGER(3600),a={iss:NODE_CONFIG.UIAP.GooglePlay.clientEmail,scope:"https://www.googleapis.com/auth/androidpublisher",aud:o,exp:i,iat:t},s=Buffer.from(STRINGIFY({alg:"RS256",typ:"JWT"})).toString("base64")+"."+Buffer.from(STRINGIFY(a)).toString("base64");s+="."+n.createSign("RSA-SHA256").update(s).sign(NODE_CONFIG.UIAP.GooglePlay.privateKey,"base64"),POST({isSecure:"https:"===r.protocol,host:r.hostname===TO_DELETE?void 0:r.hostname,port:r.port===TO_DELETE?void 0:INTEGER(r.port),uri:r.pathname===TO_DELETE?void 0:r.pathname.substring(1),paramStr:"grant_type="+encodeURIComponent("urn:ietf:params:oauth:grant-type:jwt-bearer")+"&assertion="+encodeURIComponent(s),headers:{"Content-Type":"application/x-www-form-urlencoded"}},{error:()=>{c()},success:o=>{let t=PARSE_STR(o);void 0===t?c():e(t.access_token)}})},()=>{return e=>{GET({isSecure:!0,host:"www.googleapis.com",uri:"androidpublisher/v2/applications/"+encodeURIComponent(NODE_CONFIG.UIAP.GooglePlay.appPackageName)+"/purchases/products/"+encodeURIComponent(s)+"/tokens/"+encodeURIComponent(p)+"?access_token="+encodeURIComponent(e)},e=>{let o=PARSE_STR(e);void 0===o?c():void 0!==a&&a(void 0!==o.error?!1:void 0!==o.purchaseTimeMillis?!0:!1)})}}])})}}});