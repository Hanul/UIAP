UIAP.APP_STORE_PURCHASE_VALIDATE=METHOD({run:(e,o)=>{let t,n,i=e.productId,r=e.receipt;void 0!==o&&(CHECK_IS_DATA(o)!==!0?n=o:(t=o.error,n=o.success));let a=RAR(()=>{let e="buy.itunes.apple.com";RUN(o=>{let t;POST(t={isSecure:!0,host:e,uri:"verifyReceipt",paramStr:JSON.stringify({"receipt-data":r})},{error:()=>{a()},success:t=>{let r=PARSE_STR(t),s=!1;void 0===r?a():(0===r.status&&void 0!==r.receipt&&(r.receipt.product_id===i?s=!0:void 0!==r.receipt.in_app&&EACH(r.receipt.in_app,e=>{if(e.product_id===i)return s=!0,!1})),s!==!0&&"sandbox.itunes.apple.com"!==e?(e="sandbox.itunes.apple.com",o()):void 0!==n&&n(s))}})})})}}),UIAP.GOOGLE_PLAY_GET_VOIDED_PURCHASES=METHOD(e=>{let o,t,n="https://www.googleapis.com/oauth2/v4/token",i=require("url"),r=require("crypto"),a=i.parse(n);return{run:e=>{let i,s;void 0!==e&&(CHECK_IS_DATA(e)!==!0?s=e:(i=e.error,s=e.success)),NEXT([e=>{if(void 0===o||Date.now()-t.getTime()>18e5){let i=INTEGER(Date.now()/1e3),s=i+INTEGER(3600),p={iss:NODE_CONFIG.UIAP.GooglePlay.clientEmail,scope:"https://www.googleapis.com/auth/androidpublisher",aud:n,exp:s,iat:i},c=new Buffer(STRINGIFY({alg:"RS256",typ:"JWT"})).toString("base64")+"."+new Buffer(STRINGIFY(p)).toString("base64");c+="."+r.createSign("RSA-SHA256").update(c).sign(NODE_CONFIG.UIAP.GooglePlay.privateKey,"base64"),POST({isSecure:"https:"===a.protocol,host:a.hostname===TO_DELETE?void 0:a.hostname,port:a.port===TO_DELETE?void 0:INTEGER(a.port),uri:a.pathname===TO_DELETE?void 0:a.pathname.substring(1),paramStr:"grant_type="+encodeURIComponent("urn:ietf:params:oauth:grant-type:jwt-bearer")+"&assertion="+encodeURIComponent(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}},n=>{let i=PARSE_STR(n);void 0!==i&&(o=i.access_token,t=new Date,e())})}else e()},()=>{return()=>{GET({isSecure:!0,host:"www.googleapis.com",uri:"androidpublisher/v2/applications/"+encodeURIComponent(NODE_CONFIG.UIAP.GooglePlay.appPackageName)+"/purchases/voidedpurchases?access_token="+encodeURIComponent(o)},e=>{let o=PARSE_STR(e);void 0!==o&&void 0!==o.voidedPurchases&&s(o.voidedPurchases)})}}])}}}),UIAP.GOOGLE_PLAY_PURCHASE_VALIDATE=METHOD(e=>{let o,t,n="https://www.googleapis.com/oauth2/v4/token",i=require("url"),r=require("crypto"),a=i.parse(n);return{run:(e,i)=>{let s,p,c=e.productId,u=e.purchaseToken;void 0!==i&&(CHECK_IS_DATA(i)!==!0?p=i:(s=i.error,p=i.success));let d=RAR(()=>{NEXT([e=>{if(void 0===o||Date.now()-t.getTime()>18e5){let i=INTEGER(Date.now()/1e3),s=i+INTEGER(3600),p={iss:NODE_CONFIG.UIAP.GooglePlay.clientEmail,scope:"https://www.googleapis.com/auth/androidpublisher",aud:n,exp:s,iat:i},c=new Buffer(STRINGIFY({alg:"RS256",typ:"JWT"})).toString("base64")+"."+new Buffer(STRINGIFY(p)).toString("base64");c+="."+r.createSign("RSA-SHA256").update(c).sign(NODE_CONFIG.UIAP.GooglePlay.privateKey,"base64"),POST({isSecure:"https:"===a.protocol,host:a.hostname===TO_DELETE?void 0:a.hostname,port:a.port===TO_DELETE?void 0:INTEGER(a.port),uri:a.pathname===TO_DELETE?void 0:a.pathname.substring(1),paramStr:"grant_type="+encodeURIComponent("urn:ietf:params:oauth:grant-type:jwt-bearer")+"&assertion="+encodeURIComponent(c),headers:{"Content-Type":"application/x-www-form-urlencoded"}},{error:()=>{d()},success:n=>{let i=PARSE_STR(n);void 0===i?d():(o=i.access_token,t=new Date,e())}})}else e()},()=>{return()=>{GET({isSecure:!0,host:"www.googleapis.com",uri:"androidpublisher/v2/applications/"+encodeURIComponent(NODE_CONFIG.UIAP.GooglePlay.appPackageName)+"/purchases/products/"+encodeURIComponent(c)+"/tokens/"+encodeURIComponent(u)+"?access_token="+encodeURIComponent(o)},e=>{let o=PARSE_STR(e);void 0===o?d():void 0!==p&&p(void 0!==o.error?!1:void 0!==o.purchaseTimeMillis?!0:!1)})}}])})}}});